<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Shoot on {{ .Meta.Date.Format " 02 Jan, 2006" }}.">
    <meta property="og:site_name" content="Antonio Pitasi's Photos">
    <meta property="og:url" content="https://anto.ph/pic/{{ .ID }}">
    <meta property="og:title" content="Antonio Pitasi's Photos">
    <meta property="og:description" content="Shoot on {{ .Meta.Date.Format " 02 Jan, 2006" }}.">
    <meta property="og:type" content="article">
    <meta property="og:image" content="{{ .CanonicalURL }}/l.webp">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="{{ .CanonicalURL }}/l.webp">
    <meta name="twitter:site" content="@zaphodias">
    <meta name="twitter:creator" content="@zaphodias">
    <meta name="twitter:title" content="Antonio Pitasi's Photos">
    <meta name="twitter:description" content="Shoot on {{ .Meta.Date.Format " 02 Jan, 2006" }}.">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon.png">
    <link rel="icon" type="image/webp" href="/static/images/favicon.webp">
    <link rel="icon" href="/static/images/favicon.ico">
    {{ if .Nav.Next }}
    <link rel="prefetch" href="{{ .Nav.Next.URL }}">
    {{ end }}
    {{ if .Nav.Prev }}
    <link rel="prefetch" href="{{ .Nav.Prev.URL }}">
    {{ end }}
    <title>Photos - Antonio Pitasi</title>
    <script defer data-domain="anto.ph" src="/js/ps.js"></script>
    <style>
        *,
        *:before,
        *:after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: black;
            color: white;
            font-family: sans-serif;
            font-size: 16px;
        }

        header {
            padding: 10px;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;

            display: flex;
            flex-direction: row;
            justify-content: space-between;

            font-size: 0.875rem;

            a {
                color: white;
                text-decoration: none;
                font-weight: bold;
            }
        }

        section {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;

            .image-container {
                position: relative;
                width: 100%;

                @media (max-width: 900px) {
                    a {
                        display: none;
                    }
                }

                a {
                    position: absolute;
                    top: 50%;
                    transform: translateY(-50%);
                    padding: 0.5rem;
                    margin: 0;
                    z-index: 1;

                    div {
                        background: rgba(255, 255, 255, 0.6);
                        border: none;
                        width: 1.5rem;
                        height: 1.5rem;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: black;

                        svg {
                            width: 100%;
                            height: 100%;
                        }
                    }

                    &.btn-left {
                        left: 0;
                    }

                    &.btn-right {
                        right: 0;
                    }
                }

                .gallery-wrapper {
                    width: 100%;
                    max-width: 900px;
                    overflow: hidden;
                    view-transition-name: gallery-wrapper;
                }

                .gallery {
                    display: flex;
                    flex-direction: row;
                    align-items: start;
                    width: 300%;
                    transform: translateX(calc(-100% / 3));
                    transition: transform 0.3s ease-in-out, height 0.3s ease-in-out;

                    & img {
                        background: rgba(255, 255, 255, 0.1);
                        display: block;
                        width: calc(100% / 3);
                        height: auto;
                        max-height: calc(100vh - 45px);
                        flex-shrink: 0;
                        object-fit: contain;
                        transition: filter 0.5s;
                    }

                    & .current {
                        z-index: 1;
                    }
                }
            }
        }

        .title {
            display: block;
            margin-top: 1rem;
            margin-left: 0.5rem;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .tags {
            margin-top: 0.5rem;
            font-size: 0.875rem;

            a {
                color: white;
                text-decoration: none;
                background: rgba(255, 255, 255, 0.1);
                padding: 0.2rem 0.5rem;
                border-radius: 0.2rem;
                margin-right: 0.5rem;

                &:hover {
                    background: rgba(255, 255, 255, 0.2);
                }
            }
        }

        .info {
            margin-left: 0.5rem;
            opacity: 0.5;

            &:hover {
                opacity: 1;
            }

            p {
                line-height: 1.5;
            }
        }

        footer {
            padding: 0 0.5rem;
            max-width: 900px;
            margin: 2rem auto 0 auto;

            a {
                color: white;
                text-decoration: none;
                font-weight: bold;
            }

            p {
                margin-top: 0.5rem;
                color: rgba(255, 255, 255, 0.5);
            }
        }

        .preview {
            filter: blur(4vw);
            transform: scale(1.1);
        }
    </style>
</head>

<body>
    <header>
        <a href="/">
            antonio pitasi
        </a>
        <a href="https://anto.pt">
            anto.pt â†’
        </a>
    </header>
    <section>
        <div class="image-container">
            {{ if .Nav.Prev }}
            <a class="btn-left" href="{{ .Nav.Prev.URL }}">
                <div>
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(90)">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M6.29289 8.79289C6.68342 8.40237 7.31658 8.40237 7.70711 8.79289L12 13.0858L16.2929 8.79289C16.6834 8.40237 17.3166 8.40237 17.7071 8.79289C18.0976 9.18342 18.0976 9.81658 17.7071 10.2071L12.7071 15.2071C12.3166 15.5976 11.6834 15.5976 11.2929 15.2071L6.29289 10.2071C5.90237 9.81658 5.90237 9.18342 6.29289 8.79289Z"
                                fill="currentColor"></path>
                        </g>
                    </svg>
                </div>
            </a>
            {{ end }}

            <div class="gallery-wrapper">
                <div class="gallery">
                    {{ if .Nav.Prev }}
                    <img
                      class="image left"
                      alt="Previous image"
                      width={{ .Nav.Prev.Meta.Width }}
                      height={{ .Nav.Prev.Meta.Height }}
                      data-preview="{{ .Nav.Prev.CanonicalURL }}/blur.webp"
                      src="{{ .Nav.Prev.CanonicalURL }}/w_1200.webp"
                      srcset="
                        {{ if (ge .Nav.Prev.Meta.Width 1200) }}{{ .Nav.Prev.CanonicalURL }}/w_1200.webp 1200w,{{ end }}
                        {{ if (ge .Nav.Prev.Meta.Width 1900) }}{{ .Nav.Prev.CanonicalURL }}/w_1900.webp 1900w,{{ end }}
                        {{ if (ge .Nav.Prev.Meta.Width 2500) }}{{ .Nav.Prev.CanonicalURL }}/w_2500.webp 2500w,{{ end }}
                      "
                      sizes="
                        (max-width: 1200px) 1200px,
                        (max-width: 1900px) 1900px,
                        2500px
                      "
                      loading="lazy"
                    />
                    {{ else }}
                    <img
                      class="image left"
                      width={{ .Meta.Width }}
                      height={{ .Meta.Height }}
                    />
                    {{ end }}

                    <img
                      class="image current"
                      alt="Current image"
                      width={{ .Meta.Width }}
                      height={{ .Meta.Height }}
                      srcset="
                        {{ if (ge .Meta.Width 1200) }}{{ .CanonicalURL }}/w_1200.webp 1200w,{{ end }}
                        {{ if (ge .Meta.Width 1900) }}{{ .CanonicalURL }}/w_1900.webp 1900w,{{ end }}
                        {{ if (ge .Meta.Width 2500) }}{{ .CanonicalURL }}/w_2500.webp 2500w,{{ end }}
                      "
                      sizes="
                        (max-width: 1200px) 1200px,
                        (max-width: 1900px) 1900px,
                        2500px
                      "
                    />

                    {{ if .Nav.Next }}
                    <img
                      class="image right"
                      alt="Next image"
                      width={{ .Nav.Next.Meta.Width }}
                      height={{ .Nav.Next.Meta.Height }}
                      data-preview="{{ .Nav.Next.CanonicalURL }}/blur.webp"
                      srcset="
                        {{ if (ge .Nav.Next.Meta.Width 1200) }}{{ .Nav.Next.CanonicalURL }}/w_1200.webp 1200w,{{ end }}
                        {{ if (ge .Nav.Next.Meta.Width 1900) }}{{ .Nav.Next.CanonicalURL }}/w_1900.webp 1900w,{{ end }}
                        {{ if (ge .Nav.Next.Meta.Width 2500) }}{{ .Nav.Next.CanonicalURL }}/w_2500.webp 2500w,{{ end }}
                      "
                      sizes="
                        (max-width: 1200px) 1200px,
                        (max-width: 1900px) 1900px,
                        2500px
                      "
                      loading="lazy"
                    />
                    {{ else }}
                    <img
                      class="image right"
                      width={{ .Meta.Width }}
                      height={{ .Meta.Height }}
                    />
                    {{ end }}
                </div>
            </div>

            {{ if .Nav.Next }}
            <a class="btn-right" href="{{ .Nav.Next.URL }}">
                <div>
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(270)">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M6.29289 8.79289C6.68342 8.40237 7.31658 8.40237 7.70711 8.79289L12 13.0858L16.2929 8.79289C16.6834 8.40237 17.3166 8.40237 17.7071 8.79289C18.0976 9.18342 18.0976 9.81658 17.7071 10.2071L12.7071 15.2071C12.3166 15.5976 11.6834 15.5976 11.2929 15.2071L6.29289 10.2071C5.90237 9.81658 5.90237 9.18342 6.29289 8.79289Z"
                                fill="currentColor"></path>
                        </g>
                    </svg>
                </div>
            </a>
            {{ end }}
        </div>
        <div class="tags">
            {{ range .Meta.Keywords }}
            <a href="/tags/{{ . }}">#{{ . }}</a>
            {{ end }}
        </div>

        <p class="title">metadata</p>
        <div class="info">
            <p>{{ .Meta.Date | prettyDate }}</p>
            <p>{{ .Meta.Camera }}</p>
            <p>{{ .Meta.Lens }}</p>
            <p>ISO {{ .Meta.ISO }}</p>
            <p>{{ .Meta.ShutterSpeed }}s</p>
            <p>f/{{ .Meta.Aperture }}</p>
        </div>
    </section>

    <footer>
        <a href="/random">ðŸ‘‰ random photo</a>
        <p>images are mine and can't be used by anyone else unless otherwise stated</p>
    </footer>

    <script>
      const section = document.querySelector("section");
      const gallery = document.querySelector(".gallery");
      const galleryTransitionOriginal = gallery.style.transition;
      let disableSwipe = false;
      let startX = 0; // Initial touch point
      let currentTranslateX = -100/3; // Start centered on the current image
      let isDragging = false;
      gallery.style.transform = `translateX(calc(-100% / 3))`;
      window.addEventListener('pageshow', (event) => {
        if (event.persisted) {
          // handle back button to reset slide position
          disableSwipe = false;
          startX = 0;
          currentTranslateX = -100/3;
          isDragging = false;
          gallery.style.transform = `translateX(calc(-100% / 3))`;
          updateGalleryCurrentImageHeight();
        }
      });

      gallery.addEventListener("touchstart", (e) => {
        if (disableSwipe) return;
        e.preventDefault();
        startX = e.touches[0].clientX; // Track the initial touch point
        isDragging = true;
        gallery.style.transition = "none"; // Disable transition during swipe
      });

      gallery.addEventListener("touchmove", (e) => {
        if (disableSwipe || !isDragging) return;
        e.preventDefault();
        const deltaX = e.touches[0].clientX - startX;
        {{ if not .Nav.Prev }}
        if (deltaX > 0) {
            return;
        }
        {{ end }}
        {{ if not .Nav.Next }}
        if (deltaX < 0) {
            return;
        }
        {{ end }}
        const newTranslate = currentTranslateX + (deltaX / window.innerWidth) * 100/3;
        gallery.style.transform = `translateX(${newTranslate}%)`; // Update transform dynamically

        const startImage = document.querySelector(".image.current");
        const startImageHeight = getImageHeight(startImage);
        const nextImage = deltaX > 0 ?
          document.querySelector(".image.left") :
          document.querySelector(".image.right");
        const nextImageHeight = getImageHeight(nextImage);
        const deltaH = nextImageHeight-startImageHeight;
        const h = startImageHeight + Math.abs(deltaX / window.innerWidth) * deltaH;
        gallery.style.height = `${h}px`;
      });

      gallery.addEventListener("touchend", (e) => {
        if (disableSwipe) return;
        e.preventDefault();
        isDragging = false;
        const endX = e.changedTouches[0].clientX;
        const deltaX = endX - startX;

        {{ if .Nav.Prev }}
        if (deltaX > 50) {
          // Swipe right
          currentTranslateX += 100/3;
          navigateTo("prev");
          return;
        }
        {{ end }}

        {{ if .Nav.Next }}
        if (deltaX < -50) {
          // Swipe left
          currentTranslateX -= 100/3;
          navigateTo("next");
          return;
        }
        {{ end }}

        // Snap back to current
        gallery.style.transition = galleryTransitionOriginal;
        gallery.style.transform = `translateX(${currentTranslateX}%)`;
      });

      function navigateTo(direction) {
        disableSwipe = true;
        const nextImage = direction === "prev" ?
              document.querySelector(".image.left") :
              document.querySelector(".image.right");
        gallery.style.transition = galleryTransitionOriginal;
        if (nextImage) {
          updateGalleryHeight(nextImage);
        }
        gallery.style.transform = `translateX(${currentTranslateX}%)`;
        setTimeout(() => {
          {{ if .Nav.Prev }}
          if (direction === "prev") {
            window.location.href = "{{ .Nav.Prev.URL }}";
            return;
          }
          {{ end }}
          {{ if .Nav.Next }}
          if (direction === "next") {
            window.location.href = "{{ .Nav.Next.URL }}";
            return;
          }
          {{ end }}
        }, 300);
      }

      function getImageHeight(image) {
        const gallery = document.querySelector(".gallery");
        const realW = image.attributes.width.value
        const realH = image.attributes.height.value;
        const renderH = image.height;
        const currentImageHeight = Math.min(renderH, window.innerWidth / realW * realH);
        return currentImageHeight;
      }

      function updateGalleryHeight(image) {
        const currentImageHeight = getImageHeight(image);
        gallery.style.height = `${currentImageHeight}px`; // Apply it as max-height
      }

      function updateGalleryCurrentImageHeight() {
          const currentImage = document.querySelector(".image.current");
          updateGalleryHeight(currentImage);
      }

      document.addEventListener("DOMContentLoaded", updateGalleryCurrentImageHeight);
      window.addEventListener("resize", updateGalleryCurrentImageHeight);

      document.addEventListener("keydown", (e) => {
        {{ if .Nav.Next }}
        if (!disableSwipe && e.key === "ArrowRight") {
          e.preventDefault();
          currentTranslateX -= 100/3;
          navigateTo("next");
        }
        {{ end }}
        {{ if .Nav.Prev }}
        if (!disableSwipe && e.key === "ArrowLeft") {
          e.preventDefault();
          currentTranslateX += 100/3;
          navigateTo("prev");
        }
        {{ end }}
      });

      const btnLeft = document.querySelector(".btn-left");
      const btnRight = document.querySelector(".btn-right");
      if (btnLeft) {
        btnLeft.addEventListener("click", (e) => {
          {{ if .Nav.Prev }}
          e.preventDefault();
          currentTranslateX += 100/3;
          navigateTo("prev");
          {{ end }}
        });
      }
      if (btnRight) {
        btnRight.addEventListener("click", (e) => {
          {{ if .Nav.Next }}
          e.preventDefault();
          currentTranslateX -= 100/3;
          navigateTo("next");
          {{ end }}
        });
      }

      if (window.innerWidth < 625 && !localStorage.getItem("galleryOnboardingShown")) {
        localStorage.setItem("galleryOnboardingShown", "true");
        setTimeout(() => {
          const gallery = document.querySelector(".gallery");

          {{ if .Nav.Next }}
          gallery.style.transform = "translateX(calc(-105% / 3))";
          {{ end }}

          setTimeout(() => {
            {{ if .Nav.Prev }}
            gallery.style.transform = "translateX(calc(-95% / 3))";
            {{ end }}
            setTimeout(() => {
              gallery.style.transform = "translateX(calc(-100% / 3))";
            }, 300);
          }, 300);
        }, 500);
      }

      document.querySelectorAll(".image").forEach(img => {
        setTimeout(() => {
          if (!img.complete) {
            addPreview(img);
          }
        }, 10);
      });

      function addPreview(img) {
        if (!im.dataset.preview) {
          return;
        }
        img.backgroundImage = `url(${im.dataset.preview})`;
        img.backgroundSize = "contain";
        img.classList.add("preview");
        img.onload = () => removePreview(img);
      }

      function removePreview(img) {
          img.classList.remove("preview");
          img.style.backgroundImage = null;
      }
    </script>
</body>

</html>
